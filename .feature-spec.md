# Feature Specification: Provider Page Redesign (REVISED)

**Branch**: `feature/provider-page-redesign`
**Status**: Planning - Awaiting Approval
**Last Updated**: 2025-11-22 (Revision 2)

---

## Executive Summary

Redesign Settings â†’ Providers to use **compact cards** (like MetadataTab pattern). Remove unused priority tabs, simplify to single page with all providers visible. Show real-time stats, clear API key indicators, and test connections inline.

**Key Changes**:
- âŒ Remove Asset Selection tab (unused - 17 files of dead code)
- âŒ Remove Metadata Selection tab (unused)
- âŒ Remove accordions (too many clicks)
- âœ… Single page with compact provider cards
- âœ… Real-time stats (API calls last 24hrs)
- âœ… Auto-disable if no API key
- âœ… Password field with show/hide button

---

## Visual Design

### Page Layout

```
Settings â†’ Providers
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metadata Providers                               â”‚
â”‚ Configure metadata and asset providers           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ TMDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ON]â”€â”
â”‚ Movies â€¢ TV Shows               [?] [Test] [âœ“]   â”‚
â”‚ â“˜ Using embedded key â€¢ Get personal key â†’        â”‚
â”‚ API Key: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢  [ğŸ‘]  Language: [EN â–¼]   â”‚
â”‚ ğŸ“Š 142 calls (24hrs) â€¢ Last: 2 mins ago          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Fanart.tv â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ON]â”€â”
â”‚ Movies â€¢ TV â€¢ Music                 [?] [Test]    â”‚
â”‚ Personal API key configured âœ“                     â”‚
â”‚ Personal Key: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢  [ğŸ‘]                 â”‚
â”‚ ğŸ“Š 87 calls (24hrs) â€¢ Last: 15 mins ago          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ OMDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[OFF]â”
â”‚ Movies â€¢ TV                         [?] [Test]    â”‚
â”‚ âš  API key required - provider disabled           â”‚
â”‚ API Key: [empty]  [ğŸ‘]                           â”‚
â”‚ Get free API key â†’ omdbapi.com                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€ Disabled Providers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€ TVDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[OFF]â”
â”‚ TV Shows â€¢ Season Posters           [?] [Enable]  â”‚
â”‚ Disabled â€¢ No API key configured                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ IMDb â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[OFF]â”
â”‚ Movies â€¢ TV                         [?] [Enable]  â”‚
â”‚ âš  Web scraping - Legal concerns                  â”‚
â”‚ Disabled â€¢ Use with caution                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Card Anatomy

### Enabled Provider Card (with Personal Key)

```
â”Œâ”€ Fanart.tv â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ON]â”€â”
â”‚ Movies â€¢ TV â€¢ Music                 [?] [Test]    â”‚  <- Header
â”‚ Personal API key configured âœ“                     â”‚  <- Key status
â”‚ Personal Key: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢  [ğŸ‘]                 â”‚  <- Password field
â”‚ ğŸ“Š 87 calls (24hrs) â€¢ Last: 15 mins ago          â”‚  <- Stats
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Components**:
1. **Header Row**:
   - Provider name (bold)
   - Toggle switch [ON/OFF]
2. **Capabilities Row**:
   - Media types supported (Movies â€¢ TV â€¢ Music)
   - Question icon [?] (hover: shows full capabilities)
   - Test button (async with loading state)
   - Status icon (âœ“ success, âœ— error, ~ pending)
3. **API Key Status Row**:
   - "Personal API key configured âœ“" (muted green)
   - OR "Using embedded key â€¢ Get personal key â†’" (muted yellow link)
   - OR "âš  API key required - provider disabled" (red, if missing)
4. **Configuration Row** (conditionally shown):
   - API Key field (password type with eye toggle)
   - Additional fields (Language, Region - provider-specific)
5. **Stats Row** (if stats available):
   - ğŸ“Š icon + call count + time range
   - Last successful fetch timestamp

### Disabled Provider Card

```
â”Œâ”€ TVDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[OFF]â”
â”‚ TV Shows â€¢ Season Posters           [?] [Enable]  â”‚
â”‚ Disabled â€¢ No API key configured                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Visual Styling**:
- Grayed out text (`text-neutral-500`)
- Dashed border (`border-dashed border-neutral-700`)
- No configuration fields shown
- "Enable" button instead of "Test"

---

## Card States

### State 1: Enabled + Personal Key + Healthy

```
â”Œâ”€ TMDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ON]â”€â”
â”‚ Movies â€¢ TV Shows               [?] [Test] [âœ“]   â”‚
â”‚ Personal API key configured âœ“                     â”‚
â”‚ Personal Key: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢  [ğŸ‘]  Lang: [EN â–¼]  â”‚
â”‚ ğŸ“Š 142 calls (24hrs) â€¢ Last: 2 mins ago          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 2: Enabled + Embedded Key + Warning

```
â”Œâ”€ TMDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ON]â”€â”
â”‚ Movies â€¢ TV Shows               [?] [Test] [âœ“]   â”‚
â”‚ â“˜ Using embedded key â€¢ Get personal key â†’        â”‚
â”‚ API Key: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢  [ğŸ‘]  Language: [EN â–¼]   â”‚
â”‚ ğŸ“Š Shared key - rate limits may apply            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 3: Enabled + No Key + Auto-Disabled

```
â”Œâ”€ OMDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[OFF]â”
â”‚ Movies â€¢ TV                         [?] [Test]    â”‚
â”‚ âš  API key required - provider auto-disabled      â”‚
â”‚ API Key: [empty]  [ğŸ‘]                           â”‚
â”‚ Get free API key â†’ omdbapi.com                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Logic**: If user toggles ON but API key is empty and required, auto-toggle back to OFF with error message.

### State 4: Disabled + Manual

```
â”Œâ”€ TVDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[OFF]â”
â”‚ TV Shows â€¢ Season Posters           [?] [Enable]  â”‚
â”‚ Disabled â€¢ Click Enable to configure              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 5: Error State

```
â”Œâ”€ TMDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ON]â”€â”
â”‚ Movies â€¢ TV Shows               [?] [Test] [âœ—]   â”‚
â”‚ âŒ Connection failed: Invalid API key             â”‚
â”‚ API Key: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢  [ğŸ‘]  Language: [EN â–¼]   â”‚
â”‚ ğŸ“Š Last success: 2 hours ago                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Architecture

### 1. `ProvidersPage` (Main Container)

```typescript
export const ProvidersPage: React.FC = () => {
  const { data: providers } = useProviders();
  const { data: stats } = useProviderStats(10000); // 10-second refetch

  const enabledProviders = providers?.filter(p => p.config.enabled) || [];
  const disabledProviders = providers?.filter(p => !p.config.enabled) || [];

  return (
    <div className="space-y-3">
      <PageHeader
        title="Metadata Providers"
        description="Configure metadata and asset providers"
      />

      {/* Enabled Providers */}
      {enabledProviders.map(provider => (
        <ProviderCard
          key={provider.metadata.name}
          provider={provider}
          stats={stats?.[provider.metadata.name]}
          enabled={true}
        />
      ))}

      {/* Divider */}
      {disabledProviders.length > 0 && (
        <div className="text-center text-neutral-500 text-sm py-4">
          â”€â”€â”€ Disabled Providers â”€â”€â”€
        </div>
      )}

      {/* Disabled Providers */}
      {disabledProviders.map(provider => (
        <ProviderCard
          key={provider.metadata.name}
          provider={provider}
          enabled={false}
        />
      ))}
    </div>
  );
};
```

### 2. `ProviderCard` (Individual Provider Card)

```typescript
interface ProviderCardProps {
  provider: ProviderWithMetadata;
  stats?: ProviderStats;
  enabled: boolean;
}

export const ProviderCard: React.FC<ProviderCardProps> = ({
  provider,
  stats,
  enabled
}) => {
  const [showPassword, setShowPassword] = useState(false);
  const [config, setConfig] = useState(provider.config);
  const [testResult, setTestResult] = useState<TestResult | null>(null);

  const updateProvider = useUpdateProvider();
  const testProvider = useTestProvider();

  // Auto-disable if API key required but missing
  const isAutoDisabled = provider.metadata.requiresApiKey &&
                         !config.apiKey &&
                         enabled;

  useEffect(() => {
    if (isAutoDisabled) {
      updateProvider.mutate({
        name: provider.metadata.name,
        data: { enabled: false }
      });
      toast.error(`${provider.metadata.displayName} requires an API key`);
    }
  }, [isAutoDisabled]);

  return (
    <div className={cn(
      "card",
      !enabled && "opacity-60 border-dashed"
    )}>
      <div className="card-body space-y-2">
        {/* Header Row */}
        <ProviderHeader
          provider={provider}
          enabled={enabled}
          onToggle={handleToggle}
          testResult={testResult}
          onTest={handleTest}
        />

        {/* Capabilities Row */}
        <ProviderCapabilities provider={provider} />

        {/* API Key Status */}
        <ProviderKeyStatus
          provider={provider}
          config={config}
          enabled={enabled}
        />

        {/* Configuration (only if enabled) */}
        {enabled && (
          <ProviderConfig
            provider={provider}
            config={config}
            onChange={handleConfigChange}
            showPassword={showPassword}
            onTogglePassword={() => setShowPassword(!showPassword)}
          />
        )}

        {/* Stats (only if enabled and stats available) */}
        {enabled && stats && (
          <ProviderStats stats={stats} />
        )}
      </div>
    </div>
  );
};
```

### 3. `ProviderHeader` (Header Row)

```typescript
interface ProviderHeaderProps {
  provider: ProviderWithMetadata;
  enabled: boolean;
  onToggle: (enabled: boolean) => void;
  testResult: TestResult | null;
  onTest: () => void;
}

export const ProviderHeader: React.FC<ProviderHeaderProps> = ({
  provider,
  enabled,
  onToggle,
  testResult,
  onTest
}) => {
  return (
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-3">
        <h3 className="text-lg font-semibold">{provider.metadata.displayName}</h3>
        <Switch checked={enabled} onCheckedChange={onToggle} />
      </div>

      <div className="flex items-center gap-2">
        {/* Test Result Icon */}
        {testResult && (
          <StatusIcon status={testResult.success ? 'success' : 'error'} />
        )}

        {/* Test Button */}
        {enabled && (
          <Button
            variant="secondary"
            size="sm"
            onClick={onTest}
            disabled={!config.apiKey && provider.metadata.requiresApiKey}
          >
            Test
          </Button>
        )}

        {/* Enable Button (disabled providers) */}
        {!enabled && (
          <Button
            variant="primary"
            size="sm"
            onClick={() => onToggle(true)}
          >
            Enable
          </Button>
        )}
      </div>
    </div>
  );
};
```

### 4. `ProviderCapabilities` (Media Types + Info Icon)

```typescript
interface ProviderCapabilitiesProps {
  provider: ProviderWithMetadata;
}

export const ProviderCapabilities: React.FC<ProviderCapabilitiesProps> = ({
  provider
}) => {
  const [showTooltip, setShowTooltip] = useState(false);

  const mediaTypes = getMediaTypes(provider.metadata.supportedAssetTypes);

  return (
    <div className="flex items-center gap-2 text-sm text-neutral-400">
      <span>{mediaTypes.join(' â€¢ ')}</span>

      <Tooltip open={showTooltip} onOpenChange={setShowTooltip}>
        <TooltipTrigger asChild>
          <Button variant="ghost" size="sm" className="h-6 w-6 p-0">
            <FontAwesomeIcon icon={faCircleQuestion} />
          </Button>
        </TooltipTrigger>
        <TooltipContent>
          <ProviderCapabilitiesDetail provider={provider} />
        </TooltipContent>
      </Tooltip>
    </div>
  );
};
```

### 5. `ProviderKeyStatus` (API Key Indicator)

```typescript
interface ProviderKeyStatusProps {
  provider: ProviderWithMetadata;
  config: ProviderConfig;
  enabled: boolean;
}

export const ProviderKeyStatus: React.FC<ProviderKeyStatusProps> = ({
  provider,
  config,
  enabled
}) => {
  // Required but missing
  if (provider.metadata.requiresApiKey && !config.apiKey) {
    return (
      <div className="text-sm text-red-400 flex items-center gap-2">
        <FontAwesomeIcon icon={faExclamationTriangle} />
        <span>API key required - provider disabled</span>
        {provider.metadata.apiKeyBenefit && (
          <a
            href={getApiKeyUrl(provider.metadata.name)}
            target="_blank"
            className="text-primary hover:underline"
          >
            Get API key â†’
          </a>
        )}
      </div>
    );
  }

  // Using personal key
  if (config.personalApiKey) {
    return (
      <div className="text-sm text-green-500/70 flex items-center gap-2">
        <FontAwesomeIcon icon={faCheckCircle} />
        <span>Personal API key configured</span>
      </div>
    );
  }

  // Using embedded key
  if (config.apiKey && provider.metadata.apiKeyOptional) {
    return (
      <div className="text-sm text-amber-400/70 flex items-center gap-2">
        <FontAwesomeIcon icon={faInfoCircle} />
        <span>Using embedded key</span>
        <a
          href={getApiKeyUrl(provider.metadata.name)}
          target="_blank"
          className="text-primary hover:underline"
        >
          Get personal key â†’
        </a>
      </div>
    );
  }

  // Disabled
  if (!enabled) {
    return (
      <div className="text-sm text-neutral-500">
        Disabled â€¢ Click Enable to configure
      </div>
    );
  }

  return null;
};
```

### 6. `ProviderConfig` (Configuration Fields)

```typescript
interface ProviderConfigProps {
  provider: ProviderWithMetadata;
  config: ProviderConfig;
  onChange: (field: string, value: string) => void;
  showPassword: boolean;
  onTogglePassword: () => void;
}

export const ProviderConfig: React.FC<ProviderConfigProps> = ({
  provider,
  config,
  onChange,
  showPassword,
  onTogglePassword
}) => {
  return (
    <div className="grid grid-cols-2 gap-3">
      {/* API Key Field */}
      {provider.metadata.requiresApiKey && (
        <div className="relative">
          <Label>API Key</Label>
          <div className="relative">
            <Input
              type={showPassword ? 'text' : 'password'}
              value={config.apiKey || ''}
              onChange={(e) => onChange('apiKey', e.target.value)}
              placeholder="Enter API key"
              className="pr-10"
            />
            <Button
              variant="ghost"
              size="sm"
              className="absolute right-1 top-1 h-7 w-7 p-0"
              onClick={onTogglePassword}
            >
              <FontAwesomeIcon icon={showPassword ? faEyeSlash : faEye} />
            </Button>
          </div>
        </div>
      )}

      {/* Personal API Key (optional) */}
      {provider.metadata.apiKeyOptional && (
        <div className="relative">
          <Label>Personal Key (optional)</Label>
          <div className="relative">
            <Input
              type={showPassword ? 'text' : 'password'}
              value={config.personalApiKey || ''}
              onChange={(e) => onChange('personalApiKey', e.target.value)}
              placeholder="Optional personal key"
              className="pr-10"
            />
            <Button
              variant="ghost"
              size="sm"
              className="absolute right-1 top-1 h-7 w-7 p-0"
              onClick={onTogglePassword}
            >
              <FontAwesomeIcon icon={showPassword ? faEyeSlash : faEye} />
            </Button>
          </div>
        </div>
      )}

      {/* Language (TMDB, TVDB only) */}
      {provider.metadata.name === 'tmdb' && (
        <div>
          <Label>Language</Label>
          <Select value={config.language} onValueChange={(v) => onChange('language', v)}>
            <SelectTrigger>
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="en">English</SelectItem>
              {/* ... more languages */}
            </SelectContent>
          </Select>
        </div>
      )}

      {/* Region (TMDB only) */}
      {provider.metadata.name === 'tmdb' && (
        <div>
          <Label>Region</Label>
          <Select value={config.region} onValueChange={(v) => onChange('region', v)}>
            <SelectTrigger>
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="US">United States</SelectItem>
              {/* ... more regions */}
            </SelectContent>
          </Select>
        </div>
      )}
    </div>
  );
};
```

### 7. `ProviderStats` (Usage Statistics)

```typescript
interface ProviderStatsProps {
  stats: ProviderStats;
}

interface ProviderStats {
  totalCalls24h: number;
  lastSuccessfulFetch?: Date;
  successRate?: number;
}

export const ProviderStats: React.FC<ProviderStatsProps> = ({ stats }) => {
  const timeAgo = stats.lastSuccessfulFetch
    ? formatTimeAgo(stats.lastSuccessfulFetch)
    : 'Never';

  return (
    <div className="text-sm text-neutral-400 flex items-center gap-4">
      <div className="flex items-center gap-2">
        <FontAwesomeIcon icon={faChartLine} />
        <span>{stats.totalCalls24h} calls (24hrs)</span>
      </div>

      {stats.lastSuccessfulFetch && (
        <div className="flex items-center gap-2">
          <span>â€¢</span>
          <span>Last: {timeAgo}</span>
        </div>
      )}

      {stats.successRate !== undefined && (
        <div className="flex items-center gap-2">
          <span>â€¢</span>
          <span>{(stats.successRate * 100).toFixed(1)}% success</span>
        </div>
      )}
    </div>
  );
};
```

---

## Backend Changes

### Required: Provider Statistics API

**New Endpoint**: `GET /api/providers/statistics`

**Response**:
```typescript
{
  providers: {
    tmdb: {
      totalCalls24h: 142,
      lastSuccessfulFetch: '2025-11-22T10:30:00Z',
      successRate: 0.98,
      callsByHour: [12, 15, 8, ...] // Last 24 hours
    },
    fanart: {
      totalCalls24h: 87,
      lastSuccessfulFetch: '2025-11-22T10:15:00Z',
      successRate: 1.0
    },
    // ... other providers
  }
}
```

**Implementation**:
```sql
-- Count calls in last 24 hours by provider
SELECT
  provider_name,
  COUNT(*) as total_calls,
  MAX(fetched_at) as last_fetch,
  AVG(CASE WHEN status = 'success' THEN 1.0 ELSE 0.0 END) as success_rate
FROM provider_call_log
WHERE fetched_at >= datetime('now', '-24 hours')
GROUP BY provider_name;
```

**Note**: Requires new table `provider_call_log` to track API calls. Alternative: use existing `provider_assets` table with `fetched_at` timestamp.

### Optional Enhancements

1. **Enhanced Provider Response**: Add `statistics` field to `GET /api/providers`
2. **PATCH Endpoint**: `PATCH /api/providers/:name` for partial updates
3. **Response Caching**: 60-second cache for provider list

---

## State Management

### TanStack Query Hooks

```typescript
// Provider list (cached, invalidated on updates)
const { data: providers } = useProviders();

// Provider statistics (10-second auto-refresh)
const { data: stats } = useProviderStats({
  refetchInterval: 10000,
  staleTime: 8000
});

// Update provider config
const updateProvider = useMutation({
  mutationFn: (vars) => providerApi.update(vars.name, vars.data),
  onSuccess: () => {
    queryClient.invalidateQueries(['providers']);
    queryClient.invalidateQueries(['provider-stats']);
  }
});

// Test provider connection
const testProvider = useMutation({
  mutationFn: (name) => providerApi.test(name)
});
```

### Auto-Save Pattern

**Debounced updates on field blur**:
```typescript
const debouncedUpdate = useDebouncedCallback(
  (field: string, value: string) => {
    updateProvider.mutate({
      name: provider.metadata.name,
      data: { [field]: value }
    });
  },
  500
);

const handleChange = (field: string, value: string) => {
  setLocalConfig(prev => ({ ...prev, [field]: value }));
  debouncedUpdate(field, value);
};
```

---

## Implementation Plan

### Phase 1: Core Structure (3-4 hours)
1. Create `ProvidersPage` component
2. Implement `ProviderCard` with basic layout
3. Wire up `useProviders` hook
4. Test card rendering for all providers

**Deliverable**: Static provider cards visible

### Phase 2: Configuration & State (4-5 hours)
1. Implement `ProviderConfig` with password toggle
2. Add enable/disable logic with auto-disable
3. Add auto-save with debouncing
4. Implement `ProviderKeyStatus` indicators

**Deliverable**: Functional configuration

### Phase 3: Backend Stats (2-3 hours)
1. Create `provider_call_log` table OR use existing tables
2. Implement `GET /api/providers/statistics` endpoint
3. Add `useProviderStats` hook with 10-second refresh
4. Implement `ProviderStats` component

**Deliverable**: Real-time statistics display

### Phase 4: Test Connection (2 hours)
1. Wire up test button to existing API
2. Add loading state with async button
3. Show inline status icons
4. Error handling and toast notifications

**Deliverable**: Working test connections

### Phase 5: Polish & Cleanup (3-4 hours)
1. Remove 17 files of orphaned priority code
2. Delete unused components (modals, tabs)
3. Add keyboard navigation
4. Mobile responsive design
5. Manual testing

**Deliverable**: Production-ready, cleaned codebase

### Phase 6: Documentation (1 hour)
1. Update CONFIGURATION.md
2. Update PROVIDERS.md
3. Delete feature spec before merge

**Total Estimated Time**: 15-19 hours

---

## Success Criteria

### Must-Have
âœ… All providers visible on one page
âœ… No tabs, no accordions, no modals
âœ… Auto-disable if API key required but missing
âœ… Password fields with show/hide toggle
âœ… Clear enabled/disabled visual states
âœ… API key indicators (embedded vs personal)
âœ… Test connection button working
âœ… Real-time stats (if backend implemented)
âœ… Auto-save on field blur
âœ… Mobile responsive
âœ… Orphaned priority code removed

### Should-Have
âœ… 10-second stats refresh
âœ… Keyboard navigation
âœ… Accessibility (ARIA labels)
âœ… Loading skeletons
âœ… Error states

### Nice-to-Have
âšª Hourly call charts
âšª Provider health dashboard
âšª Bulk enable/disable

---

## Code Cleanup

### Files to Remove (17 total)

**Backend**:
- `src/services/priorityConfigService.ts`
- `src/controllers/priorityConfigController.ts`
- `src/types/priority.ts` (if exists)

**Frontend Components**:
- `public/frontend/src/components/provider/AssetTypePriorityConfig.tsx`
- `public/frontend/src/components/provider/MetadataFieldPriorityConfig.tsx`
- `public/frontend/src/components/provider/AutoSelectionStrategyToggle.tsx` (if exists)
- `public/frontend/src/components/provider/ProviderConfigModal.tsx`
- `public/frontend/src/components/provider/AddProviderModal.tsx`
- `public/frontend/src/components/provider/AddProviderCard.tsx`
- `public/frontend/src/components/provider/ProviderCoverageStatus.tsx` (misleading)

**Frontend Hooks**:
- `public/frontend/src/hooks/usePriorities.ts`

**API Routes**:
- Remove `/api/priorities/*` routes from `src/routes/api.ts`

**Misc**:
- Any priority-related utility functions
- Priority presets in `src/config/providerMetadata.ts`

---

## Migration Notes

**No breaking changes** - this is purely a UI/UX redesign. All backend APIs remain functional.

**User Impact**:
- Existing provider configurations preserved
- No data migration needed
- URL stays the same (`/settings/providers`)

---

## Approval Required

**Please review and approve**:
1. Compact card design (no tabs, no accordions)
2. Real-time stats with 10-second refresh
3. API key indicators and auto-disable logic
4. Removal of 17 files of orphaned code
5. Implementation timeline (15-19 hours)

**Ready to proceed?**
