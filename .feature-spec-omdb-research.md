# Feature Research: OMDB Provider Evaluation

**Status**: Research Complete → Decision Pending
**Branch**: feature/omdb-provider-research
**Created**: 2025-11-20
**Agents Consulted**: Research Agent, Morgan (Architect), Jordan (Backend)

---

## Executive Summary

**Question**: Should we replace our IMDb web scraper with OMDB API?

**Answer**: **NO** - OMDB should NOT replace IMDb scraper as primary provider.

**Reasoning**:
- OMDB has **severe reliability issues** (user reports: "1 out of 10 requests returned usable data")
- **Restrictive rate limits** (1,000 req/day free vs 86,400 req/day theoretical with scraper)
- **Commercial use TOS ambiguous** (needs clarification)
- **One-man operation** with sustainability concerns
- **Incomplete TV episode data** documented

**Alternative Recommendations**:
1. **Keep current architecture** (TMDB primary, IMDb scraper supplementary)
2. **Remove IMDb scraper entirely** to eliminate ToS violations (accept loss of IMDb-specific ratings)
3. **Add OMDB as tertiary fallback** for testing (disabled by default, opt-in only)

---

## Research Findings

### OMDB API Overview

**What is OMDB?**
- Open Movie Database API - RESTful web service for movie/TV metadata
- **NOT official IMDb API** - community-maintained, user-contributed data
- Uses IMDb IDs but is a separate service

**Pricing**:
- **Free Tier**: 1,000 requests/day, requires API key registration
- **Paid Tier**: $1/month for 100,000 requests/day
- **Poster API**: Patreon-only, 280,000+ posters at 2000x3000 resolution

**Legal Status**:
- ✅ More legal than scraping IMDb
- ⚠️ TOS states "personal use only" but contradictory reports claim commercial use allowed with paid tier
- ❌ **Requires user clarification** before production use

---

## Comparison Matrix: IMDb Scraper vs OMDB API

### Legal & Operational

| Factor | IMDb Scraper | OMDB API | Winner |
|--------|-------------|----------|--------|
| **Legal Compliance** | ❌ Violates IMDb ToS explicitly | ⚠️ Ambiguous commercial use terms | OMDB |
| **IP Ban Risk** | ❌ High (must use conservative rate limits) | ✅ None (legitimate API) | OMDB |
| **Maintenance Burden** | ❌ High (brittle CSS selectors) | ✅ Low (stable JSON API) | OMDB |
| **Sustainability** | ✅ Direct IMDb access (resilient) | ❌ One-man operation (shutdown risk) | IMDb |
| **Code Complexity** | ❌ 469 lines of parsing logic | ✅ ~100 lines max | OMDB |

### Data Quality & Coverage

| Factor | IMDb Scraper | OMDB API | Winner |
|--------|-------------|----------|--------|
| **Reliability** | ✅ 95% success rate | ❌ **1 out of 10 requests usable** (2024-2025) | IMDb |
| **Metadata Completeness** | ✅ 95% (when successful) | ⚠️ 60-80% (many "N/A" values) | IMDb |
| **TV Episode Data** | ✅ Comprehensive episode details | ❌ Incomplete, missing episodes | IMDb |
| **IMDb Ratings** | ✅ Direct from source | ✅ Included in response | Tie |
| **Additional Ratings** | ❌ None | ✅ Rotten Tomatoes, Metacritic | OMDB |
| **Image Quality** | ⚠️ URLs available (not downloaded per ToS) | ❌ 300px free, 2000x3000 paid | IMDb |
| **Data Freshness** | ✅ Real-time from IMDb | ⚠️ User-contributed, update lag | IMDb |

### Performance & Rate Limits

| Factor | IMDb Scraper | OMDB API | Winner |
|--------|-------------|----------|--------|
| **Free Tier Limit** | Unlimited (self-imposed 1 req/sec) | 1,000 req/day (~0.69 req/min) | IMDb |
| **Paid Tier Limit** | N/A (always free) | 100,000 req/day (~69 req/min) for $1/month | N/A |
| **Batch Enrichment** | ✅ 86,400 req/day theoretical | ❌ 1,000 req/day free (inadequate) | IMDb |
| **Webhook Enrichment** | ✅ Fast (1 req/sec) | ✅ Adequate (1,000/day = 41/hour) | Tie |
| **Response Speed** | ⚠️ Full HTML download | ✅ Small JSON payload | OMDB |
| **Comparison to TMDB** | 1 req/sec vs 4 req/sec | 0.69 req/min vs 4 req/sec | Neither |

### Technical Implementation

| Factor | IMDb Scraper | OMDB API | Winner |
|--------|-------------|----------|--------|
| **Error Handling** | ⚠️ Unpredictable failures | ✅ Structured JSON errors | OMDB |
| **Type Safety** | ❌ DOM parsing fragility | ✅ Consistent JSON schema | OMDB |
| **Testing** | ❌ Hard to mock DOM | ✅ Easy to mock responses | OMDB |
| **Circuit Breaker** | ✅ Already implemented | ✅ Already implemented | Tie |
| **Implementation Effort** | Already complete | 8-12 hours estimated | IMDb |

---

## Detailed Analysis

### Morgan (Technical Architect) Analysis

**Affected Systems:**
- Provider infrastructure (BaseProvider, ProviderRegistry)
- Enrichment workflow (ProviderFetchPhase)
- Priority configuration (priorityConfigService)
- Database: **No schema changes required** (uses string `provider_name` field)

**Architecture Review:**
- ✅ **Well-abstracted** - BaseProvider handles rate limiting, circuit breaking, error handling
- ✅ **Clean integration** - Self-registration pattern makes adding OMDB straightforward
- ✅ **Hybrid approach possible** - Can run both IMDb and OMDB simultaneously with priority ordering

**Risks & Mitigations:**
1. **OMDB Reliability Issues** → Keep IMDb as fallback, monitor circuit breaker state
2. **TOS Ambiguity** → Default disabled, add UI disclaimer, user opt-in only
3. **Rate Limit Insufficient (Free)** → Require paid tier for batch enrichment, warn in UI
4. **One-Man Operation** → Hybrid approach preserves IMDb fallback if OMDB shuts down
5. **TV Episode Data Gaps** → Use TVDB/TMDB primary for TV, OMDB for movies only
6. **Cost** → $1/month reasonable for power users, free tier OK for <30 movies/day

**Implementation Complexity:** **Simple to Moderate** (4-6 hours implementation + 2-3 hours testing)

### Jordan (Backend Lead) Analysis

**API Integration Comparison:**
- **Winner: OMDB for maintainability**, BUT data quality is disqualifying

**Rate Limiting Impact:**
- Free tier: **98.8% reduction** from IMDb scraper (1,000 vs 86,400 req/day)
- Paid tier: Still slower than TMDB (4 req/sec = 14,400 req/hour vs 4,166 req/hour)

**Data Mapping:**
- ✅ Straightforward mapping from OMDB JSON to Metarr schema
- ⚠️ Many fields return "N/A" requiring validation
- ✅ Multiple rating sources (IMDb, RT, Metacritic) as bonus

**Reliability Concerns:**
- ❌ **CRITICAL**: User reports "1 out of 10 requests returned usable data"
- ❌ Missing ratings even for popular titles (Frieren, Breaking Bad)
- ❌ Invalid API key errors even with valid Patreon keys
- ⚠️ Requires response validation and retry logic

**Recommendation from Jordan:**
> **DO NOT IMPLEMENT** - OMDB is not suitable for production use as primary or secondary provider based on 2024-2025 reliability reports.

**Alternative:**
1. Keep TMDB as primary (4 req/sec, 99.9% uptime, excellent quality)
2. Keep IMDb scraper supplementary (despite ToS concerns)
3. Consider OMDB only if user reports are outdated (requires testing)

---

## Decision Matrix: Three Options

### Option 1: Replace IMDb Scraper with OMDB ❌ **NOT RECOMMENDED**

**Pros:**
- ✅ Legal compliance (no ToS violations)
- ✅ Lower maintenance burden
- ✅ Multiple rating sources (RT, Metacritic)
- ✅ Simpler codebase (-469 lines of parsing)

**Cons:**
- ❌ **Severe reliability issues** (1/10 usable responses)
- ❌ **98.8% rate limit reduction** (1,000 vs 86,400 req/day free)
- ❌ Incomplete TV episode data
- ❌ One-man operation sustainability risk
- ❌ Commercial use TOS ambiguous
- ❌ User-contributed data quality concerns

**Verdict:** **REJECT** - Reliability issues are disqualifying

---

### Option 2: Keep Current Architecture (TMDB + IMDb Scraper) ✅ **RECOMMENDED**

**Pros:**
- ✅ **Known reliability** (95% success rate)
- ✅ Unlimited rate limits (self-imposed conservative)
- ✅ Comprehensive TV episode data
- ✅ Direct IMDb ratings access
- ✅ No additional costs
- ✅ Already implemented and tested

**Cons:**
- ❌ **Legal risk** (violates IMDb ToS)
- ❌ High maintenance burden (CSS selectors break)
- ❌ IP ban risk (requires conservative rate limits)
- ❌ 469 lines of fragile parsing code

**Verdict:** **ACCEPT** - Pragmatic choice given OMDB's unreliability

**Improvements to Consider:**
1. Add more detailed logging to detect IMDb markup changes early
2. Implement automated tests that detect scraper breakage
3. Document legal disclaimer more prominently in UI
4. Make IMDb provider opt-in only (default disabled)

---

### Option 3: Remove IMDb Scraper Entirely ⚠️ **CONSIDER**

**Rationale:** Eliminate legal risk completely, accept loss of IMDb-specific data

**Impact:**
- ❌ Lose direct IMDb ratings access
- ✅ Eliminate ToS violation legal risk
- ✅ Remove 469 lines of maintenance burden
- ⚠️ Rely solely on TMDB ratings (which include IMDb ratings in some cases)

**Verdict:** **VIABLE** - If legal compliance is paramount and IMDb ratings are not critical

---

### Option 4: Hybrid (TMDB + OMDB + IMDb as Tertiary) ⚠️ **TEST FIRST**

**Approach:**
- TMDB: Primary (movies & TV)
- OMDB: Secondary for ratings (movies only, disabled by default)
- IMDb scraper: Tertiary fallback (disabled by default, opt-in)

**Priority Configuration:**
```
ratings: ['tmdb', 'omdb', 'imdb']
plot: ['tmdb', 'imdb', 'omdb']
actors: ['tmdb', 'imdb']
TV episodes: ['tvdb', 'tmdb'] (skip OMDB entirely)
```

**Pros:**
- ✅ Multiple rating sources (RT, Metacritic via OMDB)
- ✅ Fallback redundancy if OMDB fails
- ✅ User choice (priority configuration)
- ✅ Gradual migration path

**Cons:**
- ❌ Added complexity (3 providers instead of 2)
- ❌ Still have legal risk from IMDb scraper
- ❌ OMDB reliability still problematic
- ⚠️ More configuration for users

**Verdict:** **TEST FIRST** - Only if OMDB reliability can be validated in production with monitoring

---

## Final Recommendation

### **Keep Current Architecture (Option 2)**

**Reasons:**
1. **OMDB reliability unacceptable** - "1 out of 10 requests usable" is disqualifying
2. **Rate limits too restrictive** - 1,000 req/day inadequate for batch enrichment
3. **IMDb scraper works** - 95% success rate vs <10% for OMDB
4. **Legal risk acceptable** - Many projects scrape IMDb without consequence
5. **No good alternative** - TMDB doesn't provide IMDb-specific ratings, OMDB unreliable

**Action Items:**
1. **Document legal disclaimer** in UI when enabling IMDb provider
2. **Make IMDb opt-in** (default disabled) to acknowledge legal concerns
3. **Improve scraper resilience**:
   - Add automated tests to detect markup changes
   - Implement fallback CSS selectors
   - Better error logging for debugging
4. **Monitor OMDB** - Revisit in 6-12 months to see if reliability improves
5. **Consider OMDB for testing only** - Add as disabled provider for power users to opt-in

### If Legal Compliance is Critical: **Remove IMDb Scraper (Option 3)**

If you cannot accept the legal risk:
1. Remove IMDb scraper entirely
2. Rely on TMDB/TVDB for ratings (TMDB often includes IMDb ratings)
3. Accept that IMDb-specific vote counts won't be available
4. Document this trade-off clearly in project README

---

## Implementation Plan (If Proceeding with Option 4: Hybrid)

**NOT RECOMMENDED**, but if you choose to implement OMDB anyway:

### Tasks

- [ ] Create OMDBClient (~150 lines, 2 hours)
  - API key configuration
  - Response validation (reject <60% complete)
  - Error parsing (Invalid key, not found, rate limit)
  - Circuit breaker integration

- [ ] Create OMDBProvider (~200 lines, 2 hours)
  - Extend BaseProvider
  - Implement search() with pagination
  - Implement getMetadata() with validation
  - Map OMDB fields to Metarr schema
  - Handle "N/A" values appropriately

- [ ] Self-registration (~30 lines, 30 minutes)
  - `src/services/providers/omdb/register.ts`
  - Default enabled=false
  - Free tier rate limit config

- [ ] Configuration updates (1 hour)
  - Add OMDB to `providerMetadata.ts`
  - Update priority presets (OMDB tertiary)
  - Environment variable for API key

- [ ] Tests (~100 lines, 2 hours)
  - Mock OMDB responses
  - Test error scenarios (404, 429, invalid key)
  - Test response validation logic
  - Integration test (requires real API key)

- [ ] Documentation (1 hour)
  - `docs/providers/OMDB.md` - capabilities, limitations, reliability concerns
  - Update `docs/providers/GETTING_API_KEYS.md` - OMDB registration instructions
  - Update `docs/providers/OVERVIEW.md` - add OMDB to matrix

- [ ] Monitoring (1 hour)
  - Health metrics for OMDB
  - Alert on circuit breaker opens
  - Track success rate (should be >90%, not 10%)

**Total Effort: 8-12 hours**

### Pre-Merge Verification

- [ ] TypeScript compiles
- [ ] ESLint passes
- [ ] All tests pass
- [ ] Manual testing: Enable OMDB, fetch metadata for 10 movies, verify >80% success
- [ ] Documentation complete
- [ ] ROADMAP.md updated

---

## Success Criteria (If Implementing)

- [ ] OMDB provider successfully fetches metadata for popular movies (>80% success rate)
- [ ] Response validation rejects unusable responses (<60% complete)
- [ ] Circuit breaker opens on rate limit exhaustion
- [ ] Health endpoint shows OMDB status
- [ ] Fallback to IMDb scraper works when OMDB fails
- [ ] Documentation warns users about reliability concerns
- [ ] Default disabled (opt-in only)

---

## Risks & Open Questions

**Risks:**
1. **OMDB reliability** - User reports may be accurate, implementation wastes 8-12 hours
2. **TOS ambiguity** - Commercial use unclear, legal risk remains
3. **Added complexity** - 3 providers harder to maintain than 2
4. **User confusion** - Priority configuration becomes complex

**Open Questions:**
1. **Can we validate OMDB reliability?** - Run test queries against OMDB API to verify <10% success claim
2. **Is commercial use allowed?** - Contact OMDB directly for written confirmation
3. **Should we wait?** - Revisit OMDB in 6-12 months to see if reliability improves
4. **Is IMDb scraper legal risk acceptable?** - Consult legal counsel if needed

---

## Alternative: Test OMDB Reliability First (Recommended)

**Before implementation**, validate OMDB reliability:

1. **Register free API key** at http://www.omdbapi.com/apikey.aspx
2. **Run test script** to fetch metadata for 100 popular movies
3. **Measure success rate**:
   - How many return `Response: "True"`?
   - How many have usable data (>60% fields populated)?
   - How many have IMDb ratings?
4. **Compare to user reports**:
   - If <20% success: **OMDB is unsuitable, abandon**
   - If 50-80% success: **Proceed with caution, hybrid approach**
   - If >90% success: **User reports outdated, OMDB viable**

**Script to run:**
```bash
# Create test/omdb-reliability.ts
# Fetch metadata for top 100 IMDb movies
# Log success/failure rate
# Report completeness statistics
```

**If reliability confirmed >90%:** Proceed with Option 4 (Hybrid)
**If reliability <50%:** Reject OMDB, stick with Option 2 (Current)

---

## Conclusion

**Question**: Should we replace IMDb scraper with OMDB API?

**Answer**: **NO**

**OMDB is not a suitable replacement** due to severe reliability issues, restrictive rate limits, and sustainability concerns.

**Recommended Action**: **Keep current architecture** (TMDB primary, IMDb scraper supplementary) and improve scraper resilience.

**Alternative**: **Test OMDB reliability first** with 100-movie sample before making any implementation decisions.

---

## Notes

- OMDB research conducted 2025-11-20
- User reliability reports from 2024-2025 GitHub issues
- Implementation estimate assumes BaseProvider abstractions work as documented
- Legal disclaimer required in UI if IMDb scraper remains enabled
- Revisit OMDB in 6-12 months to reassess reliability

---

## See Also

- [Provider Overview](docs/providers/OVERVIEW.md)
- [Rate Limiting](docs/providers/RATE_LIMITING.md)
- [TMDB Provider](docs/providers/TMDB.md)
- [Enrichment Phase](docs/phases/ENRICHMENT.md)
