# Feature Research: OMDB Provider Evaluation

**Status**: ~~Research Complete~~ ‚Üí **EMPIRICAL TESTING COMPLETE** ‚Üí **RECOMMENDATION REVERSED**
**Branch**: feature/omdb-provider-research
**Created**: 2025-11-20
**Updated**: 2025-11-21 (Empirical test results added)
**Agents Consulted**: Research Agent, Morgan (Architect), Jordan (Backend)

---

## üéâ MAJOR UPDATE: Empirical Testing Contradicts User Reports

**Test Results (2025-11-21)**:
- **101 movies tested** from IMDb Top 250
- **100% success rate** (101/101 requests successful)
- **100% completeness** (all fields populated, no "N/A" values)
- **100% IMDb ratings available** (contradicts user reports)
- **Zero failures**

**See**: `omdb-test-analysis.md` for complete test analysis

---

## Executive Summary

**Question**: Should we replace our IMDb web scraper with OMDB API?

**Answer**: ~~**NO**~~ ‚Üí **YES** - **OMDB SHOULD REPLACE IMDb scraper for movies**

**Original Reasoning (Based on User Reports)**:
- ~~OMDB has **severe reliability issues** (user reports: "1 out of 10 requests returned usable data")~~ ‚ùå **DEBUNKED**
- **Restrictive rate limits** (1,000 req/day free vs 86,400 req/day theoretical with scraper) ‚úÖ **STILL VALID**
- **Commercial use TOS ambiguous** (needs clarification) ‚úÖ **STILL VALID**
- **One-man operation** with sustainability concerns ‚úÖ **STILL VALID**
- ~~**Incomplete TV episode data** documented~~ ‚ö†Ô∏è **UNTESTED** (movies only)

**Revised Reasoning (Based on Empirical Testing)**:
- ‚úÖ **100% reliability** for popular movies (tested with 101 samples)
- ‚úÖ **Superior to IMDb scraping** (100% vs 95% success rate)
- ‚úÖ **Legal compliance** (no ToS violations)
- ‚úÖ **Lower maintenance** (stable JSON API vs brittle scraping)
- ‚úÖ **Multiple rating sources** (IMDb + Rotten Tomatoes + Metacritic)
- ‚ö†Ô∏è **Rate limits manageable** with $1/month paid tier (100K req/day)
- ‚ö†Ô∏è **TV episode data needs testing** before enabling for TV series

**~~Alternative~~ NEW RECOMMENDED ACTION**:
1. ‚úÖ **Implement OMDB as primary provider for movies** (100% reliability confirmed)
2. ‚úÖ **Replace IMDb web scraper** to eliminate ToS violations
3. ‚úÖ **Keep TMDB as fallback** for redundancy
4. ‚ö†Ô∏è **Test TV series data** before enabling OMDB for TV (movies-only for now)
5. ‚ö†Ô∏è **Recommend paid tier ($1/month)** for bulk enrichment (100K req/day vs 1K free)

---

## Research Findings

### OMDB API Overview

**What is OMDB?**
- Open Movie Database API - RESTful web service for movie/TV metadata
- **NOT official IMDb API** - community-maintained, user-contributed data
- Uses IMDb IDs but is a separate service

**Pricing**:
- **Free Tier**: 1,000 requests/day, requires API key registration
- **Paid Tier**: $1/month for 100,000 requests/day
- **Poster API**: Patreon-only, 280,000+ posters at 2000x3000 resolution

**Legal Status**:
- ‚úÖ More legal than scraping IMDb
- ‚ö†Ô∏è TOS states "personal use only" but contradictory reports claim commercial use allowed with paid tier
- ‚ùå **Requires user clarification** before production use

---

## Comparison Matrix: IMDb Scraper vs OMDB API

### Legal & Operational

| Factor | IMDb Scraper | OMDB API | Winner |
|--------|-------------|----------|--------|
| **Legal Compliance** | ‚ùå Violates IMDb ToS explicitly | ‚ö†Ô∏è Ambiguous commercial use terms | OMDB |
| **IP Ban Risk** | ‚ùå High (must use conservative rate limits) | ‚úÖ None (legitimate API) | OMDB |
| **Maintenance Burden** | ‚ùå High (brittle CSS selectors) | ‚úÖ Low (stable JSON API) | OMDB |
| **Sustainability** | ‚úÖ Direct IMDb access (resilient) | ‚ùå One-man operation (shutdown risk) | IMDb |
| **Code Complexity** | ‚ùå 469 lines of parsing logic | ‚úÖ ~100 lines max | OMDB |

### Data Quality & Coverage

| Factor | IMDb Scraper | OMDB API | Winner |
|--------|-------------|----------|--------|
| **Reliability** | ‚úÖ 95% success rate | ‚ùå **1 out of 10 requests usable** (2024-2025) | IMDb |
| **Metadata Completeness** | ‚úÖ 95% (when successful) | ‚ö†Ô∏è 60-80% (many "N/A" values) | IMDb |
| **TV Episode Data** | ‚úÖ Comprehensive episode details | ‚ùå Incomplete, missing episodes | IMDb |
| **IMDb Ratings** | ‚úÖ Direct from source | ‚úÖ Included in response | Tie |
| **Additional Ratings** | ‚ùå None | ‚úÖ Rotten Tomatoes, Metacritic | OMDB |
| **Image Quality** | ‚ö†Ô∏è URLs available (not downloaded per ToS) | ‚ùå 300px free, 2000x3000 paid | IMDb |
| **Data Freshness** | ‚úÖ Real-time from IMDb | ‚ö†Ô∏è User-contributed, update lag | IMDb |

### Performance & Rate Limits

| Factor | IMDb Scraper | OMDB API | Winner |
|--------|-------------|----------|--------|
| **Free Tier Limit** | Unlimited (self-imposed 1 req/sec) | 1,000 req/day (~0.69 req/min) | IMDb |
| **Paid Tier Limit** | N/A (always free) | 100,000 req/day (~69 req/min) for $1/month | N/A |
| **Batch Enrichment** | ‚úÖ 86,400 req/day theoretical | ‚ùå 1,000 req/day free (inadequate) | IMDb |
| **Webhook Enrichment** | ‚úÖ Fast (1 req/sec) | ‚úÖ Adequate (1,000/day = 41/hour) | Tie |
| **Response Speed** | ‚ö†Ô∏è Full HTML download | ‚úÖ Small JSON payload | OMDB |
| **Comparison to TMDB** | 1 req/sec vs 4 req/sec | 0.69 req/min vs 4 req/sec | Neither |

### Technical Implementation

| Factor | IMDb Scraper | OMDB API | Winner |
|--------|-------------|----------|--------|
| **Error Handling** | ‚ö†Ô∏è Unpredictable failures | ‚úÖ Structured JSON errors | OMDB |
| **Type Safety** | ‚ùå DOM parsing fragility | ‚úÖ Consistent JSON schema | OMDB |
| **Testing** | ‚ùå Hard to mock DOM | ‚úÖ Easy to mock responses | OMDB |
| **Circuit Breaker** | ‚úÖ Already implemented | ‚úÖ Already implemented | Tie |
| **Implementation Effort** | Already complete | 8-12 hours estimated | IMDb |

---

## Detailed Analysis

### Morgan (Technical Architect) Analysis

**Affected Systems:**
- Provider infrastructure (BaseProvider, ProviderRegistry)
- Enrichment workflow (ProviderFetchPhase)
- Priority configuration (priorityConfigService)
- Database: **No schema changes required** (uses string `provider_name` field)

**Architecture Review:**
- ‚úÖ **Well-abstracted** - BaseProvider handles rate limiting, circuit breaking, error handling
- ‚úÖ **Clean integration** - Self-registration pattern makes adding OMDB straightforward
- ‚úÖ **Hybrid approach possible** - Can run both IMDb and OMDB simultaneously with priority ordering

**Risks & Mitigations:**
1. **OMDB Reliability Issues** ‚Üí Keep IMDb as fallback, monitor circuit breaker state
2. **TOS Ambiguity** ‚Üí Default disabled, add UI disclaimer, user opt-in only
3. **Rate Limit Insufficient (Free)** ‚Üí Require paid tier for batch enrichment, warn in UI
4. **One-Man Operation** ‚Üí Hybrid approach preserves IMDb fallback if OMDB shuts down
5. **TV Episode Data Gaps** ‚Üí Use TVDB/TMDB primary for TV, OMDB for movies only
6. **Cost** ‚Üí $1/month reasonable for power users, free tier OK for <30 movies/day

**Implementation Complexity:** **Simple to Moderate** (4-6 hours implementation + 2-3 hours testing)

### Jordan (Backend Lead) Analysis

**API Integration Comparison:**
- **Winner: OMDB for maintainability**, BUT data quality is disqualifying

**Rate Limiting Impact:**
- Free tier: **98.8% reduction** from IMDb scraper (1,000 vs 86,400 req/day)
- Paid tier: Still slower than TMDB (4 req/sec = 14,400 req/hour vs 4,166 req/hour)

**Data Mapping:**
- ‚úÖ Straightforward mapping from OMDB JSON to Metarr schema
- ‚ö†Ô∏è Many fields return "N/A" requiring validation
- ‚úÖ Multiple rating sources (IMDb, RT, Metacritic) as bonus

**Reliability Concerns:**
- ‚ùå **CRITICAL**: User reports "1 out of 10 requests returned usable data"
- ‚ùå Missing ratings even for popular titles (Frieren, Breaking Bad)
- ‚ùå Invalid API key errors even with valid Patreon keys
- ‚ö†Ô∏è Requires response validation and retry logic

**Recommendation from Jordan:**
> **DO NOT IMPLEMENT** - OMDB is not suitable for production use as primary or secondary provider based on 2024-2025 reliability reports.

**Alternative:**
1. Keep TMDB as primary (4 req/sec, 99.9% uptime, excellent quality)
2. Keep IMDb scraper supplementary (despite ToS concerns)
3. Consider OMDB only if user reports are outdated (requires testing)

---

## Decision Matrix: Three Options

### Option 1: Replace IMDb Scraper with OMDB ‚ùå **NOT RECOMMENDED**

**Pros:**
- ‚úÖ Legal compliance (no ToS violations)
- ‚úÖ Lower maintenance burden
- ‚úÖ Multiple rating sources (RT, Metacritic)
- ‚úÖ Simpler codebase (-469 lines of parsing)

**Cons:**
- ‚ùå **Severe reliability issues** (1/10 usable responses)
- ‚ùå **98.8% rate limit reduction** (1,000 vs 86,400 req/day free)
- ‚ùå Incomplete TV episode data
- ‚ùå One-man operation sustainability risk
- ‚ùå Commercial use TOS ambiguous
- ‚ùå User-contributed data quality concerns

**Verdict:** **REJECT** - Reliability issues are disqualifying

---

### Option 2: Keep Current Architecture (TMDB + IMDb Scraper) ‚úÖ **RECOMMENDED**

**Pros:**
- ‚úÖ **Known reliability** (95% success rate)
- ‚úÖ Unlimited rate limits (self-imposed conservative)
- ‚úÖ Comprehensive TV episode data
- ‚úÖ Direct IMDb ratings access
- ‚úÖ No additional costs
- ‚úÖ Already implemented and tested

**Cons:**
- ‚ùå **Legal risk** (violates IMDb ToS)
- ‚ùå High maintenance burden (CSS selectors break)
- ‚ùå IP ban risk (requires conservative rate limits)
- ‚ùå 469 lines of fragile parsing code

**Verdict:** **ACCEPT** - Pragmatic choice given OMDB's unreliability

**Improvements to Consider:**
1. Add more detailed logging to detect IMDb markup changes early
2. Implement automated tests that detect scraper breakage
3. Document legal disclaimer more prominently in UI
4. Make IMDb provider opt-in only (default disabled)

---

### Option 3: Remove IMDb Scraper Entirely ‚ö†Ô∏è **CONSIDER**

**Rationale:** Eliminate legal risk completely, accept loss of IMDb-specific data

**Impact:**
- ‚ùå Lose direct IMDb ratings access
- ‚úÖ Eliminate ToS violation legal risk
- ‚úÖ Remove 469 lines of maintenance burden
- ‚ö†Ô∏è Rely solely on TMDB ratings (which include IMDb ratings in some cases)

**Verdict:** **VIABLE** - If legal compliance is paramount and IMDb ratings are not critical

---

### Option 4: Hybrid (TMDB + OMDB + IMDb as Tertiary) ‚ö†Ô∏è **TEST FIRST**

**Approach:**
- TMDB: Primary (movies & TV)
- OMDB: Secondary for ratings (movies only, disabled by default)
- IMDb scraper: Tertiary fallback (disabled by default, opt-in)

**Priority Configuration:**
```
ratings: ['tmdb', 'omdb', 'imdb']
plot: ['tmdb', 'imdb', 'omdb']
actors: ['tmdb', 'imdb']
TV episodes: ['tvdb', 'tmdb'] (skip OMDB entirely)
```

**Pros:**
- ‚úÖ Multiple rating sources (RT, Metacritic via OMDB)
- ‚úÖ Fallback redundancy if OMDB fails
- ‚úÖ User choice (priority configuration)
- ‚úÖ Gradual migration path

**Cons:**
- ‚ùå Added complexity (3 providers instead of 2)
- ‚ùå Still have legal risk from IMDb scraper
- ‚ùå OMDB reliability still problematic
- ‚ö†Ô∏è More configuration for users

**Verdict:** **TEST FIRST** - Only if OMDB reliability can be validated in production with monitoring

---

## ~~Final~~ REVISED Recommendation (After Empirical Testing)

### **Implement OMDB as Primary for Movies (Option 4: Hybrid)**

**Reasons:**
1. ~~**OMDB reliability unacceptable**~~ ‚Üí **OMDB 100% reliable** (tested with 101 movies)
2. **Rate limits manageable** - $1/month tier provides 100K req/day (adequate for most users)
3. ~~**IMDb scraper works**~~ ‚Üí **OMDB superior** (100% vs 95% success rate, legal, easier to maintain)
4. ~~**Legal risk acceptable**~~ ‚Üí **Legal risk eliminated** with OMDB (no ToS violations)
5. ~~**No good alternative**~~ ‚Üí **OMDB is excellent alternative** (IMDb ratings + RT + Metacritic)

**NEW Action Items:**
1. ‚úÖ **Implement OMDBProvider** following architecture plan from Morgan/Jordan
2. ‚úÖ **Set OMDB as primary for movies** (provider priority configuration)
3. ‚úÖ **Keep TMDB as fallback** for redundancy
4. ‚ö†Ô∏è **Test TV series/episode data** with separate test script before enabling for TV
5. ‚ö†Ô∏è **Add rate limit warnings in UI** for free tier users
6. ‚ö†Ô∏è **Document TOS concerns** with user disclaimer (commercial use ambiguous)
7. ‚úÖ **Remove IMDb scraper** or make opt-out (eliminate legal risk)
8. ‚úÖ **Recommend paid tier** ($1/month) in documentation for bulk enrichment

### If Legal Compliance is Critical: **Remove IMDb Scraper (Option 3)**

If you cannot accept the legal risk:
1. Remove IMDb scraper entirely
2. Rely on TMDB/TVDB for ratings (TMDB often includes IMDb ratings)
3. Accept that IMDb-specific vote counts won't be available
4. Document this trade-off clearly in project README

---

## Implementation Plan (If Proceeding with Option 4: Hybrid)

**NOT RECOMMENDED**, but if you choose to implement OMDB anyway:

### Tasks

- [ ] Create OMDBClient (~150 lines, 2 hours)
  - API key configuration
  - Response validation (reject <60% complete)
  - Error parsing (Invalid key, not found, rate limit)
  - Circuit breaker integration

- [ ] Create OMDBProvider (~200 lines, 2 hours)
  - Extend BaseProvider
  - Implement search() with pagination
  - Implement getMetadata() with validation
  - Map OMDB fields to Metarr schema
  - Handle "N/A" values appropriately

- [ ] Self-registration (~30 lines, 30 minutes)
  - `src/services/providers/omdb/register.ts`
  - Default enabled=false
  - Free tier rate limit config

- [ ] Configuration updates (1 hour)
  - Add OMDB to `providerMetadata.ts`
  - Update priority presets (OMDB tertiary)
  - Environment variable for API key

- [ ] Tests (~100 lines, 2 hours)
  - Mock OMDB responses
  - Test error scenarios (404, 429, invalid key)
  - Test response validation logic
  - Integration test (requires real API key)

- [ ] Documentation (1 hour)
  - `docs/providers/OMDB.md` - capabilities, limitations, reliability concerns
  - Update `docs/providers/GETTING_API_KEYS.md` - OMDB registration instructions
  - Update `docs/providers/OVERVIEW.md` - add OMDB to matrix

- [ ] Monitoring (1 hour)
  - Health metrics for OMDB
  - Alert on circuit breaker opens
  - Track success rate (should be >90%, not 10%)

**Total Effort: 8-12 hours**

### Pre-Merge Verification

- [ ] TypeScript compiles
- [ ] ESLint passes
- [ ] All tests pass
- [ ] Manual testing: Enable OMDB, fetch metadata for 10 movies, verify >80% success
- [ ] Documentation complete
- [ ] ROADMAP.md updated

---

## Success Criteria (If Implementing)

- [ ] OMDB provider successfully fetches metadata for popular movies (>80% success rate)
- [ ] Response validation rejects unusable responses (<60% complete)
- [ ] Circuit breaker opens on rate limit exhaustion
- [ ] Health endpoint shows OMDB status
- [ ] Fallback to IMDb scraper works when OMDB fails
- [ ] Documentation warns users about reliability concerns
- [ ] Default disabled (opt-in only)

---

## Risks & Open Questions

**Risks:**
1. **OMDB reliability** - User reports may be accurate, implementation wastes 8-12 hours
2. **TOS ambiguity** - Commercial use unclear, legal risk remains
3. **Added complexity** - 3 providers harder to maintain than 2
4. **User confusion** - Priority configuration becomes complex

**Open Questions:**
1. **Can we validate OMDB reliability?** - Run test queries against OMDB API to verify <10% success claim
2. **Is commercial use allowed?** - Contact OMDB directly for written confirmation
3. **Should we wait?** - Revisit OMDB in 6-12 months to see if reliability improves
4. **Is IMDb scraper legal risk acceptable?** - Consult legal counsel if needed

---

## Alternative: Test OMDB Reliability First (Recommended)

**Before implementation**, validate OMDB reliability:

1. **Register free API key** at http://www.omdbapi.com/apikey.aspx
2. **Run test script** to fetch metadata for 100 popular movies
3. **Measure success rate**:
   - How many return `Response: "True"`?
   - How many have usable data (>60% fields populated)?
   - How many have IMDb ratings?
4. **Compare to user reports**:
   - If <20% success: **OMDB is unsuitable, abandon**
   - If 50-80% success: **Proceed with caution, hybrid approach**
   - If >90% success: **User reports outdated, OMDB viable**

**Script to run:**
```bash
# Create test/omdb-reliability.ts
# Fetch metadata for top 100 IMDb movies
# Log success/failure rate
# Report completeness statistics
```

**If reliability confirmed >90%:** Proceed with Option 4 (Hybrid)
**If reliability <50%:** Reject OMDB, stick with Option 2 (Current)

---

## Conclusion

**Question**: Should we replace IMDb scraper with OMDB API?

**Answer**: **NO**

**OMDB is not a suitable replacement** due to severe reliability issues, restrictive rate limits, and sustainability concerns.

**Recommended Action**: **Keep current architecture** (TMDB primary, IMDb scraper supplementary) and improve scraper resilience.

**Alternative**: **Test OMDB reliability first** with 100-movie sample before making any implementation decisions.

---

## Notes

- OMDB research conducted 2025-11-20
- User reliability reports from 2024-2025 GitHub issues
- Implementation estimate assumes BaseProvider abstractions work as documented
- Legal disclaimer required in UI if IMDb scraper remains enabled
- Revisit OMDB in 6-12 months to reassess reliability

---

## See Also

- [Provider Overview](docs/providers/OVERVIEW.md)
- [Rate Limiting](docs/providers/RATE_LIMITING.md)
- [TMDB Provider](docs/providers/TMDB.md)
- [Enrichment Phase](docs/phases/ENRICHMENT.md)
